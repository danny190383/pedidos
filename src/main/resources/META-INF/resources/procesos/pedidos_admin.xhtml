<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="jakarta.faces.html"
        xmlns:ui="jakarta.faces.facelets"
        xmlns:f="http://java.sun.com/jsf/core"
        template="../templates/templateMenu.xhtml"
        xmlns:p="primefaces">

    <ui:define name="titulo">
        Pedidos
    </ui:define>

    <ui:define name="content">
        <p:panel header="ADMINISTRACIÓN DE PEDIDOS"
                 styleClass="custom-panel">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton icon="pi pi-plus"
                                     value="Generar Cheque"
                                     process="@this, formulario:tblPedidos"
                                     action="#{pedidosAdminBean.chooseCheque}">
                        <p:ajax event="dialogReturn"
                                listener="#{pedidosAdminBean.onChequeChosen}"
                                update="formulario:grMensajes, @form"/>
                    </p:commandButton>
                    <p:spacer width="10px" />
                    <p:commandButton icon="pi pi-plus"
                                     value="Validar Cheque"
                                     process="@this, formulario:tblPedidos"
                                     update="formulario:grMensajes"
                                     action="#{pedidosAdminBean.chooseValidarCheque}">
                        <p:ajax event="dialogReturn"
                                listener="#{pedidosAdminBean.onValidarChequeChosen}"
                                update="formulario:grMensajes, @form"/>
                    </p:commandButton>
                    <p:spacer width="10px" />
                    <p:commandButton icon="pi pi-plus"
                                     value="Asignar Transporte"
                                     process="@this, formulario:tblPedidos"
                                     update="formulario:grMensajes"
                                     action="#{pedidosAdminBean.chooseTransporte}">
                        <p:ajax event="dialogReturn"
                                listener="#{pedidosAdminBean.onTransporteChosen}"
                                update="formulario:grMensajes, @form"/>
                    </p:commandButton>
                    <p:spacer width="10px" />
                    <p:commandButton icon="pi pi-plus"
                                     value="Guia de Remisión"
                                     process="@this, formulario:tblPedidos"
                                     update="formulario:grMensajes"
                                     action="#{pedidosAdminBean.chooseGuia}">
                        <p:ajax event="dialogReturn"
                                listener="#{pedidosAdminBean.onGuiaChosen}"
                                update="formulario:grMensajes, @form"/>
                    </p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>
            <br/>
            <p:dataTable var="pedido"
                         paginator="true"
                         rows="10"
                         id="tblPedidos"
                         widgetVar="wgPedido"
                         rowKey="#{pedido.idPedido}"
                         rowIndexVar="index"
                         selectionMode="single"
                         selection="#{pedidosAdminBean.pedidoSelected}"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         value="#{pedidosAdminBean.lazyModel}">

                <p:column width="5%"
                          headerText="Prioritario">
                    <p:selectBooleanButton onLabel="SI" offLabel="NO"
                                           onIcon="pi pi-check"
                                           offIcon="pi pi-times"
                                           style="width:6rem"
                                           value="#{pedido.turnoPrioritario}">
                        <p:ajax event="change" listener="#{pedidosAdminBean.asignarPrioritario(index)}"
                        update="formulario:grMensajes, @this"/>
                    </p:selectBooleanButton>

                </p:column>

                <p:column headerText="Fecha Registro"
                          width="10%"
                          field="fechaRegistro"
                          filterBy="#{pedido.fechaRegistro}"
                          sortBy="#{pedido.fechaRegistro}"
                          filterPlaceholder="Fecha Registro">
                    <f:facet name="filter">
                        <p:datePicker onchange="PF('wgPedido').filter()"/>
                    </f:facet>
                    <h:outputLabel value="#{pedido.fechaRegistro}">
                        <f:convertDateTime pattern="MM/dd/yyyy HH:mm:ss" type="localDate" />
                    </h:outputLabel>
                </p:column>

                <p:column headerText="Código"
                          field="codigo"
                          filterBy="#{pedido.codigo}"
                          sortBy="#{pedido.codigo}"
                          filterPlaceholder="Código"
                          width="10%"
                          style="text-align: center;">
                    <h:outputText value="#{pedido.codigo}"/>
                </p:column>

                <p:column headerText="Terminal"
                          field="terminal.nombre"
                          filterBy="#{pedido.terminal.nombre}"
                          sortBy="#{pedido.terminal.nombre}"
                          filterPlaceholder="Terminal">
                    <h:outputText value="#{pedido.terminal.nombre}"/>
                </p:column>

                <p:column headerText="Estación"
                          field="estacionServicio.nombre"
                          filterBy="#{pedido.estacionServicio.nombre}"
                          sortBy="#{pedido.estacionServicio.nombre}"
                          filterPlaceholder="Estación">
                    <h:outputText value="#{pedido.estacionServicio.nombre}"/>
                </p:column>

                <p:column headerText="Total"
                          width="5%"
                          style="text-align: right">
                    <h:outputText value="#{pedido.total}"/>
                </p:column>

                <p:column headerText="Estado"
                          width="5%"
                          style="text-align: right">
                    <h:outputText value="#{pedido.obtenerEstadoPrioritario()}" />
                </p:column>

            </p:dataTable>
        </p:panel>
    </ui:define>
    <ui:define name="dialog">

    </ui:define>
</ui:composition>